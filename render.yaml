# ================================================================================
# âš¡ FLAWLESS GENESIS ORCHESTRATOR - Render Blueprint
# ================================================================================
# Deploy: render.com/docs/blueprint-spec
# ================================================================================

services:
  # ===========================================================================
  # GENESIS API - Main Orchestrator Service
  # ===========================================================================
  - type: web
    name: barrios-genesis-flawless
    runtime: docker
    region: ohio
    plan: starter  # Upgrade to standard for production
    
    # Health check
    healthCheckPath: /health
    
    # Scaling (for production)
    # autoDeploy: true
    # scaling:
    #   minInstances: 1
    #   maxInstances: 3
    #   targetMemoryPercent: 80
    #   targetCPUPercent: 70
    
    # Environment Variables
    envVars:
      # Redis (from Render Redis service)
      - key: REDIS_URL
        fromService:
          name: genesis-redis
          type: redis
          property: connectionString
      
      # AI API Keys (from secrets)
      - key: ANTHROPIC_API_KEY
        sync: false  # Set manually in dashboard

      - key: OPENAI_API_KEY
        sync: false  # Set manually in dashboard

      # Commercial Curator (Agent 0.5) - Perplexity for trending commercial research
      - key: PERPLEXITY_API_KEY
        sync: false  # Required for Commercial Curator Agent

      # Commercial Curator (Agent 0.5) - Firecrawl for deep scraping commercials
      - key: FIRECRAWL_API_KEY
        sync: false  # Required for deep scraping commercial URLs

      # Commercial Curator RAG Retrieval (99.75% cost savings when library populated)
      - key: QDRANT_URL
        sync: false  # Qdrant Cloud URL for commercial references

      - key: QDRANT_API_KEY
        sync: false  # Qdrant API key

      - key: QDRANT_COLLECTION
        value: commercial_references  # Collection name in Qdrant

      - key: VOYAGE_API_KEY
        sync: false  # Voyage AI for embeddings (optional, falls back to OpenAI)

      # Video Generation (Agent 4) - KIE.ai VEO 3.1
      - key: KIE_API_KEY
        sync: false  # Required for video generation

      # Voiceover Generation (Agent 5) - ElevenLabs
      - key: ELEVENLABS_API_KEY
        sync: false  # Required for voiceover generation

      # Configuration
      - key: ENVIRONMENT
        value: production
      
      - key: LOG_LEVEL
        value: INFO
      
      # OpenTelemetry (optional)
      - key: OTEL_EXPORTER_OTLP_ENDPOINT
        sync: false
      
      - key: OTEL_SERVICE_NAME
        value: genesis-flawless

  # ===========================================================================
  # REDIS - Distributed State Storage
  # ===========================================================================
  - type: redis
    name: genesis-redis
    region: ohio
    plan: starter  # 25MB, upgrade for production
    
    # Memory policy for circuit breakers and event logs
    maxmemoryPolicy: allkeys-lru
    
    # IP allow list (required by Render)
    ipAllowList: []

# ===========================================================================
# DEPLOYMENT CHECKLIST
# ===========================================================================
# 
# 1. Create GitHub repo: barrios-a2i/genesis-flawless
# 2. Push code to GitHub
# 3. Create new Blueprint in Render Dashboard
# 4. Connect GitHub repo
# 5. Render will create services from this file
# 6. Configure secrets in Dashboard:
#    - ANTHROPIC_API_KEY
#    - OPENAI_API_KEY
#    - PERPLEXITY_API_KEY (Commercial Curator Agent 0.5 - Perplexity research)
#    - FIRECRAWL_API_KEY (Commercial Curator Agent 0.5 - Deep scraping)
#    - QDRANT_URL (RAG retrieval - same as autonomous-curator)
#    - QDRANT_API_KEY (RAG retrieval - same as autonomous-curator)
#    - VOYAGE_API_KEY (Embeddings - optional, falls back to OpenAI)
#    - KIE_API_KEY (Video Generator Agent 4)
#    - ELEVENLABS_API_KEY (Voiceover Generator Agent 5)
# 7. Deploy!
#
# RAG Retrieval Integration:
# - When commercial_references collection has 3+ refs for an industry,
#   GENESIS uses RAG retrieval instead of live Perplexity/Firecrawl
# - Cost: $0.001 vs $0.40-0.50 = 99.75% savings
# - Library populated by autonomous-curator worker (every 6 hours)
#
# Post-deployment:
# - Verify health: https://barrios-genesis-flawless.onrender.com/health
# - Check metrics: https://barrios-genesis-flawless.onrender.com/metrics
# - Test SSE: https://barrios-genesis-flawless.onrender.com/docs
#
# ================================================================================
